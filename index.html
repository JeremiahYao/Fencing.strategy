<!DOCTYPE html>
<html>
<head>
  <title>Fencing Strategy Advisor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 16px; }
    h1 { text-align: center; }
    .section {
      background: white;
      padding: 14px;
      margin-bottom: 16px;
      border-radius: 10px;
    }
    button {
      margin: 4px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button.selected { background: #28a745; }
    select { width: 100%; padding: 8px; }
    .output {
      background: #111;
      color: #0f0;
      padding: 12px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>ðŸ¤º Strategy Advisor</h1>

<div class="section">
  <h3>Opponent</h3>
  <button data-field="distance" data-value="forward">Forward</button>
  <button data-field="distance" data-value="wait">Wait</button>
  <button data-field="distance" data-value="back">Back</button>
  <br><br>
  <button data-field="attack_style" data-value="simple">Simple</button>
  <button data-field="attack_style" data-value="beat">Beat</button>
  <button data-field="attack_style" data-value="compound">Compound</button>
</div>

<div class="section">
  <h3>You</h3>
  <select id="condition">
    <option value="fresh">Fresh</option>
    <option value="tired">Tired</option>
    <option value="injured">Injured</option>
  </select>
  <br><br>
  <label>
    <input type="radio" name="detail" value="normal" checked> Normal
  </label>
  <label>
    <input type="radio" name="detail" value="detailed"> Detailed
  </label>
</div>

<button onclick="getAdvice()">Get Strategy</button>

<div class="section">
  <h3>Advice</h3>
  <div id="output" class="output">Waitingâ€¦</div>
</div>

<script>
const state = {};

document.querySelectorAll("button[data-field]").forEach(btn => {
  btn.onclick = () => {
    const field = btn.dataset.field;
    document.querySelectorAll(`[data-field="${field}"]`)
      .forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
    state[field] = btn.dataset.value;
  };
});

async function getAdvice() {
  const detail = document.querySelector('input[name="detail"]:checked').value;

  const payload = {
    distance_behavior: state.distance || null,
    opening_action: state.attack_style || null,
    attack_style: state.attack_style || null,
    attack_timing: null,
    finish_line: state.finish || null,
    defense: state.defence || null,
    pressure: null,
    other_comments: document.getElementById("comments")?.value || "",
    detail_level: detail
  };

  document.getElementById("output").innerText = "Thinkingâ€¦";

  const res = await fetch(
    "https://uwprqsnidvdhchcipsvr.supabase.co/functions/v1/strategy-advisor",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3cHJxc25pZHZkaGNoY2lwc3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU1MzUsImV4cCI6MjA4MTI3MTUzNX0._et7WH9IQlMFtYbZg-UF9D5iucz92coNE8LfGAWeaOQ"
      },
      body: JSON.stringify(payload)
    }
  );

  const data = await res.json();
  document.getElementById("output").innerText =
    data.advice || data.error || "No advice returned.";
}



  document.getElementById("output").innerText = "Thinkingâ€¦";

  const res = await fetch(
    "https://uwprqsnidvdhchcipsvr.supabase.co/functions/v1/strategy-advisor",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3cHJxc25pZHZkaGNoY2lwc3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU1MzUsImV4cCI6MjA4MTI3MTUzNX0._et7WH9IQlMFtYbZg-UF9D5iucz92coNE8LfGAWeaOQ",
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3cHJxc25pZHZkaGNoY2lwc3ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTU1MzUsImV4cCI6MjA4MTI3MTUzNX0._et7WH9IQlMFtYbZg-UF9D5iucz92coNE8LfGAWeaOQ"
      },
      body: JSON.stringify(payload)
    }
  );

  const data = await res.json();
  document.getElementById("output").innerText =
    data.advice || "No advice returned.";
}
</script>

</body>
</html>
